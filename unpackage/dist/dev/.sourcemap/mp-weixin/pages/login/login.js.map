{"version":3,"sources":["webpack:///D:/用户目录/我的文档/HBuilderProjects/看图APP2/main.js","webpack:///D:/用户目录/我的文档/HBuilderProjects/看图APP2/pages/login/login.vue?8f4c","webpack:///D:/用户目录/我的文档/HBuilderProjects/看图APP2/pages/login/login.vue?a0b1","webpack:///D:/用户目录/我的文档/HBuilderProjects/看图APP2/pages/login/login.vue?93f1","webpack:///D:/用户目录/我的文档/HBuilderProjects/看图APP2/pages/login/login.vue?7508","webpack:///D:/用户目录/我的文档/HBuilderProjects/看图APP2/pages/login/login.vue"],"names":["createPage","Page","data","SessionKey","OpenId","userInfo","isCanUse","uni","getStorageSync","methods","login","e","console","log","detail","value","nameValue","passwordValue","register","checkLogin","that","checkSession","success","fail","openSetting","wx","wxGetUserInfo","_this","getUserInfo","provider","infoRes","nickName","avatarUrl","res","showLoading","title","loginRes","code","request","url","$loginUrl","method","header","openid","getApp","globalData","token","session_key","setStorageSync","hideLoading","getSetting","authSetting","updateUserInfo","reLaunch"],"mappings":"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","file":"pages/login/login.js","sourcesContent":["import 'uni-pages';import '@dcloudio/uni-stat';\nimport Vue from 'vue'\nimport Page from './pages/login/login.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./login.vue?vue&type=template&id=3fdf1a06&\"\nvar renderjs\nimport script from \"./login.vue?vue&type=script&lang=js&\"\nexport * from \"./login.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"D:/用户目录/我的文档/HBuilderProjects/看图APP2/pages/login/login.vue\"\nexport default component.exports","export * from \"-!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./login.vue?vue&type=template&id=3fdf1a06&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Desktop\\\\HBuilderX.2.4.9.20191223-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./login.vue?vue&type=script&lang=js&\"","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tSessionKey: '',\n\t\t\tOpenId: '',\n\t\t\tuserInfo: null,\n\t\t\tisCanUse: uni.getStorageSync('isCanUse') || true //默认为true\n\t\t};\n\t},\n\tmethods: {\n\t\tlogin(e) {\n\t\t\tconsole.log(\"得到账号:\" + e.detail.value.nameValue + ';得到密码:' + e.detail.value.passwordValue)\n\t\t},\n\t\tregister() {\n\t\t\tconsole.log(\"前往注册页面\")\n\t\t},\n\t\t//判断是否登录\n\t\tcheckLogin: function() {\n\t\t\tvar that = this;\n\t\t\t  uni.checkSession({\n\t\t\t\tsuccess() {\n\t\t\t\t\t// session_key 未过期，并且在本生命周期一直有效\n\t\t\t\t\tconsole.log('ok');\n\t\t\t\t},\n\t\t\t\tfail() {\n\t\t\t\t\t// session_key 已经失效，需要重新执行登录流程\n\t\t\t\t\tthat.login() // 重新登录\n\t\t\t\t\tconsole.log('expire');\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\t//\n\t\topenSetting() {\n\t\t\twx.openSetting()\n\t\t},\n\t\t//第一授权获取用户信息===》按钮触发\n\t\twxGetUserInfo() {\n\t\t\tlet _this = this;\n\t\t\tuni.getUserInfo({\n\t\t\t\tprovider: 'weixin',\n\t\t\t\tsuccess: function(infoRes) {\n\t\t\t\t\tlet nickName = infoRes.userInfo.nickName; //昵称\n\t\t\t\t\tlet avatarUrl = infoRes.userInfo.avatarUrl; //头像\n\t\t\t\t\t_this.login();\n\t\t\t\t},\n\t\t\t\tfail(res) {\n\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t//登录\n\t\tlogin() {\n\t\t\tlet _this = this;\n\t\t\tuni.showLoading({\n\t\t\t\ttitle: '登录中...'\n\t\t\t});\n\n\t\t\t// 1.wx获取登录用户code\n\t\t\tuni.login({\n\t\t\t\tprovider: 'weixin',\n\t\t\t\tsuccess: function(loginRes) {\n\t\t\t\t\tlet code = loginRes.code;\n\t\t\t\t\t//2.将用户登录code传递到后台置换用户SessionKey、OpenId等信息\n\t\t\t\t\tuni.request({\n\t\t\t\t\t\turl: _this.$loginUrl + '/api/weixin/code',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tcode: code,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\t'content-type': 'application/json'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\t_this.OpenId = res.data.openid\n\t\t\t\t\t\t\tgetApp().globalData.token = res.data.session_key\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tuni.setStorageSync('storage_key', res.data.session_key);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t//openId、或SessionKdy存储//隐藏loading\n\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tuni.getSetting({\n\t\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\t\tif (res.authSetting['scope.userInfo']) {\n\t\t\t\t\t\t\t\t// 已经授权，可以直接调用 getUserInfo 获取头像昵称\n\t\t\t\t\t\t\t\t//非第一次授权获取用户信息\n\t\t\t\t\t\t\t\twx.getUserInfo({\n\t\t\t\t\t\t\t\t\tsuccess: function(res) {\n\t\t\t\t\t\t\t\t\t\t_this.userInfo = res.userInfo\n\t\t\t\t\t\t\t\t\t\tgetApp().globalData.userInfo = res.userInfo\n\t\t\t\t\t\t\t\t\t\t_this.updateUserInfo();\n\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.log('用户未授权')\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\n\t\t// 向后台更新信息\n\t\tupdateUserInfo() {\n\t\t\tlet _this = this;\n\t\t\tuni.request({\n\t\t\t\turl: _this.$loginUrl + '/api/weixin/updateUserInfo', //服务器端地址\n\t\t\t\tdata: {\n\t\t\t\t\topenid: _this.OpenId,\n\t\t\t\t\tnickName: _this.userInfo.nickName,\n\t\t\t\t\tavatarUrl: _this.userInfo.avatarUrl,\n\t\t\t\t},\n\t\t\t\tmethod: 'POST',\n\t\t\t\theader: {\n\t\t\t\t\t'content-type': 'application/json'\n\t\t\t\t},\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tuni.reLaunch({ //信息更新成功后跳转到小程序首页\n\t\t\t\t\t\turl: '/pages/center/center'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t});\n\t\t},\n\t\tonLoad() {\n\t\t\tthis.checkLogin();\n\t\t}\n\t}\n}\n"],"sourceRoot":""}